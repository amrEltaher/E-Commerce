
// let orders = {
//   "513989": {
//     "sellerId": "1000",
//     "status": "pending",
//     "date": "1/27/2024",
//     "products": [{ "id": "4042", "cat": "watchs", "quantity": 1 }],
//     "total": 15000
//   },
//   "776572": {
//     "sellerId": "2000",
//     "status": "pending",
//     "date": "1/28/2024",
//     "products": [
//       { "id": "5423", "cat": "watchs", "quantity": 1 },
//       { "id": "5457", "cat": "watchs", "quantity": 1 },
//       { "id": "5487", "cat": "watchs", "quantity": 1 },
//       { "id": "6955", "cat": "watchs", "quantity": 1 },
//       { "id": "7090", "cat": "watchs", "quantity": 1 }
//     ],
//     "total": 57490
//   },
//   "1061254": {
//     "sellerId": "2000",
//     "status": "pending",
//     "date": "1/28/2024",
//     "products": [
//       { "id": "5423", "cat": "watchs", "quantity": 1 },
//       { "id": "5457", "cat": "watchs", "quantity": 1 },
//       { "id": "5487", "cat": "watchs", "quantity": 1 },
//       { "id": "6955", "cat": "watchs", "quantity": 1 },
//       { "id": "7090", "cat": "watchs", "quantity": 1 }
//     ],
//     "total": 57490
//   },
//   "1072085": {
//     "sellerId": "6000",
//     "status": "pending",
//     "date": "1/28/2024",
//     "products": [{ "id": "8920", "cat": "screens", "quantity": 1 }],
//     "total": 18999
//   },
//   "1119023": {
//     "sellerId": "6000",
//     "status": "pending",
//     "date": "1/28/2024",
//     "products": [{ "id": "8920", "cat": "screens", "quantity": 1 }],
//     "total": 18999
//   },
//   "1997594": {
//     "sellerId": "2000",
//     "status": "pending",
//     "date": "1/28/2024",
//     "products": [
//       { "id": "5423", "cat": "watchs", "quantity": 1 },
//       { "id": "5457", "cat": "watchs", "quantity": 1 },
//       { "id": "5487", "cat": "watchs", "quantity": 1 },
//       { "id": "6955", "cat": "watchs", "quantity": 1 },
//       { "id": "7090", "cat": "watchs", "quantity": 1 }
//     ],
//     "total": 57490
//   },
//   "2494082": {
//     "sellerId": "5000",
//     "status": "pending",
//     "date": "1/28/2024",
//     "products": [{ "id": "9683", "cat": "screens", "quantity": 1 }],
//     "total": 22599
//   },
//   "2881492": {
//     "sellerId": "2000",
//     "status": "pending",
//     "date": "1/27/2024",
//     "products": [
//       { "id": "5423", "cat": "watchs", "quantity": 1 },
//       { "id": "5457", "cat": "watchs", "quantity": 1 },
//       { "id": "5487", "cat": "watchs", "quantity": 1 },
//       { "id": "6955", "cat": "watchs", "quantity": 1 },
//       { "id": "7090", "cat": "watchs", "quantity": 1 }
//     ],
//     "total": 57490
//   },
//   "2965344": {
//     "sellerId": "1000",
//     "status": "pending",
//     "date": "1/28/2024",
//     "products": [{ "id": "4042", "cat": "watchs", "quantity": 1 }],
//     "total": 15000
//   },
//   "3401586": {
//     "sellerId": "5000",
//     "status": "pending",
//     "date": "1/27/2024",
//     "products": [{ "id": "9683", "cat": "screens", "quantity": 1 }],
//     "total": 22599
//   },
//   "3774003": {
//     "sellerId": "6000",
//     "status": "pending",
//     "date": "1/28/2024",
//     "products": [{ "id": "8920", "cat": "screens", "quantity": 1 }],
//     "total": 18999
//   },
//   "3998658": {
//     "sellerId": "6000",
//     "status": "pending",
//     "date": "1/27/2024",
//     "products": [{ "id": "8920", "cat": "screens", "quantity": 1 }],
//     "total": 18999
//   },
//   "4099137": {
//     "sellerId": "2000",
//     "status": "pending",
//     "date": "1/27/2024",
//     "products": [
//       { "id": "5423", "cat": "watchs", "quantity": 1 },
//       { "id": "5457", "cat": "watchs", "quantity": 1 },
//       { "id": "5487", "cat": "watchs", "quantity": 1 },
//       { "id": "6955", "cat": "watchs", "quantity": 1 },
//       { "id": "7090", "cat": "watchs", "quantity": 1 }
//     ],
//     "total": 57490
//   },
//   "4185668": {
//     "sellerId": "1000",
//     "status": "pending",
//     "date": "1/28/2024",
//     "products": [{ "id": "4042", "cat": "watchs", "quantity": 1 }],
//     "total": 15000
//   },
//   "4209252": {
//     "sellerId": "5000",
//     "status": "pending",
//     "date": "1/27/2024",
//     "products": [{ "id": "9683", "cat": "screens", "quantity": 1 }],
//     "total": 22599
//   },
//   "4238703": {
//     "sellerId": "1000",
//     "status": "pending",
//     "date": "1/27/2024",
//     "products": [{ "id": "4042", "cat": "watchs", "quantity": 1 }],
//     "total": 15000
//   },
//   "4271135": {
//     "sellerId": "1000",
//     "status": "pending",
//     "date": "1/27/2024",
//     "products": [{ "id": "4042", "cat": "watchs", "quantity": 1 }],
//     "total": 15000
//   },
//   "4381641": {
//     "sellerId": "5000",
//     "status": "pending",
//     "date": "1/28/2024",
//     "products": [{ "id": "9683", "cat": "screens", "quantity": 1 }],
//     "total": 22599
//   },
//   "4470582": {
//     "sellerId": "6000",
//     "status": "pending",
//     "date": "1/27/2024",
//     "products": [{ "id": "8920", "cat": "screens", "quantity": 1 }],
//     "total": 18999
//   },
//   "4668288": {
//     "sellerId": "6000",
//     "status": "pending",
//     "date": "1/28/2024",
//     "products": [{ "id": "8920", "cat": "screens", "quantity": 1 }],
//     "total": 18999
//   },
//   "4751441": {
//     "sellerId": "6000",
//     "status": "pending",
//     "date": "1/28/2024",
//     "products": [{ "id": "8920", "cat": "screens", "quantity": 1 }],
//     "total": 18999
//   },
//   "5067924": {
//     "sellerId": "1000",
//     "status": "pending",
//     "date": "1/27/2024",
//     "products": [{ "id": "4042", "cat": "watchs", "quantity": 1 }],
//     "total": 15000
//   },
//   "5242722": {
//     "sellerId": "5000",
//     "status": "pending",
//     "date": "1/27/2024",
//     "products": [{ "id": "9683", "cat": "screens", "quantity": 1 }],
//     "total": 22599
//   },
//   "6021484": {
//     "sellerId": "2000",
//     "status": "pending",
//     "date": "1/27/2024",
//     "products": [
//       { "id": "5423", "cat": "watchs", "quantity": 1 },
//       { "id": "5457", "cat": "watchs", "quantity": 1 },
//       { "id": "5487", "cat": "watchs", "quantity": 1 },
//       { "id": "6955", "cat": "watchs", "quantity": 1 },
//       { "id": "7090", "cat": "watchs", "quantity": 1 }
//     ],
//     "total": 57490
//   },
//   "6118862": {
//     "sellerId": "6000",
//     "status": "pending",
//     "date": "1/27/2024",
//     "products": [{ "id": "8920", "cat": "screens", "quantity": 1 }],
//     "total": 18999
//   },
//   "6210855": {
//     "sellerId": "1000",
//     "status": "pending",
//     "date": "1/28/2024",
//     "products": [{ "id": "4042", "cat": "watchs", "quantity": 1 }],
//     "total": 15000
//   },
//   "6440648": {
//     "sellerId": "2000",
//     "status": "pending",
//     "date": "1/28/2024",
//     "products": [
//       { "id": "5423", "cat": "watchs", "quantity": 1 },
//       { "id": "5457", "cat": "watchs", "quantity": 1 },
//       { "id": "5487", "cat": "watchs", "quantity": 1 },
//       { "id": "6955", "cat": "watchs", "quantity": 1 },
//       { "id": "7090", "cat": "watchs", "quantity": 1 }
//     ],
//     "total": 57490
//   },
//   "6640994": {
//     "sellerId": "1000",
//     "status": "pending",
//     "date": "1/28/2024",
//     "products": [{ "id": "4042", "cat": "watchs", "quantity": 1 }],
//     "total": 15000
//   },
//   "6659980": {
//     "sellerId": "5000",
//     "status": "pending",
//     "date": "1/28/2024",
//     "products": [{ "id": "9683", "cat": "screens", "quantity": 1 }],
//     "total": 22599
//   },
//   "6743211": {
//     "sellerId": "5000",
//     "status": "pending",
//     "date": "1/27/2024",
//     "products": [{ "id": "9683", "cat": "screens", "quantity": 1 }],
//     "total": 22599
//   },
//   "6828379": {
//     "sellerId": "6000",
//     "status": "pending",
//     "date": "1/27/2024",
//     "products": [{ "id": "8920", "cat": "screens", "quantity": 1 }],
//     "total": 18999
//   },
//   "7148310": {
//     "sellerId": "5000",
//     "status": "pending",
//     "date": "1/28/2024",
//     "products": [{ "id": "9683", "cat": "screens", "quantity": 1 }],
//     "total": 22599
//   },
//   "8095202": {
//     "sellerId": "2000",
//     "status": "pending",
//     "date": "1/27/2024",
//     "products": [
//       { "id": "5423", "cat": "watchs", "quantity": 1 },
//       { "id": "5457", "cat": "watchs", "quantity": 1 },
//       { "id": "5487", "cat": "watchs", "quantity": 1 },
//       { "id": "6955", "cat": "watchs", "quantity": 1 },
//       { "id": "7090", "cat": "watchs", "quantity": 1 }
//     ],
//     "total": 57490
//   },
//   "8251343": {
//     "sellerId": "1000",
//     "status": "pending",
//     "date": "1/28/2024",
//     "products": [{ "id": "4042", "cat": "watchs", "quantity": 1 }],
//     "total": 15000
//   },
//   "8517158": {
//     "sellerId": "2000",
//     "status": "pending",
//     "date": "1/28/2024",
//     "products": [
//       { "id": "5423", "cat": "watchs", "quantity": 1 },
//       { "id": "5457", "cat": "watchs", "quantity": 1 },
//       { "id": "5487", "cat": "watchs", "quantity": 1 },
//       { "id": "6955", "cat": "watchs", "quantity": 1 },
//       { "id": "7090", "cat": "watchs", "quantity": 1 }
//     ],
//     "total": 57490
//   },
//   "9045492": {
//     "sellerId": "5000",
//     "status": "pending",
//     "date": "1/28/2024",
//     "products": [{ "id": "9683", "cat": "screens", "quantity": 1 }],
//     "total": 22599
//   }
// }

//  localStorage.setItem("orders", JSON.stringify(orders));



function ordersToArray(orders) {
  let ordersArray = [];

  for (let orderKey in orders) {
    let order = orders[orderKey];
    let newOrder = {
      orderId: orderKey,
      ...order
    };
    ordersArray.push(newOrder);
  }

  return ordersArray;
}


let orders = JSON.parse(localStorage.getItem("orders")) || {};
let Products = ordersToArray(orders);
$(document).ready(function () {
  drawTable(Products);
  initializeDataTable();

  $("#filter_search").click(function () {
    $(".filter-search").toggleClass("active");
  });

  function drawTable(data) {
    let targetContainer = $("#dynamic-table-container");
    targetContainer.innerHTML = "";
    let table = $("<table>").addClass("table datanew");
    drawHeader(table, data);
    drawBody(table, data);
    targetContainer.append(table);
  }

  function drawHeader(target, test) {
    let tableHeader = $("<thead>");
    let tableHeaderRow = $("<tr>");
    let headers = Object.keys(test[0]);

    // Add select all checkbox
    let thCheckbox = $("<th>").append(
      $("<label>").addClass("checkboxs").append(
        $("<input>").attr({ type: "checkbox", id: "select-all" }),
        $("<span>").addClass("checkmarks")
      )
    );
    tableHeaderRow.append(thCheckbox);
    // handle sepcs object
    for (let header of headers) {
      if (header != "products") {
        let th = $("<th>").text(header);
        tableHeaderRow.append(th);
      }
    }
    // add actions to the end of row
    let actions = $("<th>").text("actions");
    tableHeaderRow.append(actions);

    tableHeader.append(tableHeaderRow);
    target.append(tableHeader);
  }

  function drawBody(target, test) {
    let tableBody = $("<tbody>");
    let actionButtons = ["eye", "edit", "delete"];
    const currentRow = $(this).closest("tr");
    const productId = currentRow.find("td:eq(1)").text();



    for (let j = 0; j < Products.length; j++) {
      let rowData = Object.values(test[j]);

      let row = $("<tr>");

      // Create checkbox cell
      let checkboxCell = $("<td>").append(
        $("<label>").addClass("checkboxs").append(
          $("<input>").attr("type", "checkbox"),
          $("<span>").addClass("checkmarks")
        )
      );
      row.append(checkboxCell);

      // Loop through rowData and create cells
      for (let i = 0; i < rowData.length; i++) {
        if (typeof rowData[i] != "object") {
          // if the value of the header cell is status then add badge
          let cell = $("<td>");

          if (rowData[i] === "Completed" || rowData[i] === "pending" || rowData[i] === "Cancelled") {
            let badgeClass = rowData[i] === "Completed" ? "bg-success" : rowData[i] === "pending" ? "bg-warning" : "bg-danger";
            cell.append($("<span>").addClass(`badge ${badgeClass}`).text(rowData[i]));
          } else {
            if (rowData[i].length > 20) {
              rowData[i] = rowData[i].slice(0, 20);
            }
            cell.text(rowData[i]);
          }

          row.append(cell);


        }



      }

      // Create action buttons cell
      // Create action dropdown cell
      let actionCell = $("<td>").addClass("text-center");
      let actionDropdownToggle = $("<a>")
        .addClass("action-set")
        .attr({
          href: "javascript:void(0);",
          "data-bs-toggle": "dropdown",
          "aria-expanded": "true"
        })
        .append(
          $("<i>").addClass("fa fa-ellipsis-v").attr("aria-hidden", "true")
        );

      let dropdownMenu = $("<ul>").addClass("dropdown-menu");
      for (let buttonType of actionButtons) {
        let dropdownItem = $("<li>");
        let button = $("<a>")
          .addClass("dropdown-item")
          .attr("href", "javascript:void(0);");

        const productId = row.find("td:eq(1)").text();

        switch (buttonType) {
          case 'delete':
            button.append(
              $("<img>").attr("src", "assets/img/icons/delete1.svg").addClass("me-2").attr("alt", "img"),
              "Delete Order"
            ).on("click", () => {
              deleteAction(productId, row);
            });
            break;
          case 'edit':
            button.append(
              $("<img>").attr("src", "assets/img/icons/edit.svg").addClass("me-2").attr("alt", "img"),
              "Edit Order"
            ).on("click", () => {
              window.location.href = `editOrders.html?id=${productId}`;
            });
            break;
          case 'eye':
            button.append(
              $("<img>").attr("src", "assets/img/icons/eye1.svg").addClass("me-2").attr("alt", "img"),
              "Order Details"
            ).on("click", () => {
              window.location.href = `orderDetails.html?id=${productId}`;
            });
            break;
        }

        dropdownItem.append(button);
        dropdownMenu.append(dropdownItem);
      }

      actionCell.append(actionDropdownToggle, dropdownMenu);
      row.append(actionCell);

      // Append the row to the table body
      tableBody.append(row);

    }
    target.append(tableBody);
  }
  function initializeDataTable() {
    if ($(".datanew").length > 0) {
      // Destroy existing DataTables
      $(".datanew").DataTable().destroy();

      $(".datanew").DataTable({
        bFilter: true,
        sDom: "fBtlpi",
        pagingType: "numbers",
        ordering: true,
        language: {
          search: " ",
          sLengthMenu: "_MENU_",
          searchPlaceholder: "Search...",
          info: "_START_ - _END_ of _TOTAL_ items",
        },
        initComplete: (settings, json) => {
          $(".dataTables_filter").appendTo("#tableSearch");
          $(".dataTables_filter").appendTo(".search-input");
        },
      });
    }

    var selectAllItems = "#select-all";
    var checkboxItem = ":checkbox";
    $(selectAllItems).click(function () {
      if (this.checked) {
        $(checkboxItem).each(function () {
          this.checked = true;
        });
      } else {
        $(checkboxItem).each(function () {
          this.checked = false;
        });
      }
    });
  }
  function deleteAction(id, row) {
    Swal.fire({
      title: 'Are you sure?',
      text: 'You won\'t be able to revert this!',
      icon: 'warning',
      showCancelButton: true,
      confirmButtonColor: '#3085d6',
      cancelButtonColor: '#d33',
      confirmButtonText: 'Yes, delete it!'
    }).then((result) => {
      if (result.isConfirmed) {
        Products = Products.filter(product => product.id !== id);
        console.log(Products);
        localStorage.setItem("orders", JSON.stringify(Products));
        window.location.reload();    

        Swal.fire(
          'Deleted!',
          'Your file has been deleted.',
          'success'
        );
      }
    });
  }

});
