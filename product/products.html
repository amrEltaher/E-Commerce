<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />
    <link rel="stylesheet" href="newstyle.css" />
    <script src="./JQuery.js"></script>
    <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css" />
    <script src="bootstrap//js/bootstrap.min.js"></script>
    <style>
      a:hover {
        text-decoration: none;
      }
    </style>
  </head>
  <body style="height: 100vh; width: 100vw">
    <div class="col-12 d-lg-flex flex-row h-100 p-0">
      <div
        class="col-lg-2 d-flex flex-column p-4 align-items-center border-right shadow"
      >
        <div class="h5 d-flex flex-row">
          <div
            class="rounded-circle p-2 d-flex flex-row justify-content-center align-items-center"
            style="background-color: rgb(179, 179, 179)"
          >
            <i class="fa-solid fa-filter text-white"></i>
          </div>
          <span class="pl-3">Filter</span>
        </div>
        <form action="">
          <div class="mt-3">
            <div class="h5 text-left">Category</div>
            <div class="d-flex flex-column">
              <label for="laptops">
                <input
                  type="checkbox"
                  name="category"
                  value="laptops"
                  id="laptops"
                  class=""
                />
                Laptops
              </label>
              <label for="watchs">
                <input
                  type="checkbox"
                  name="category"
                  value="watchs"
                  id="watchs"
                />
                Smart Watches
              </label>
              <label for="screens">
                <input
                  type="checkbox"
                  name="category"
                  value="screens"
                  id="screens"
                />
                Smart Screens
              </label>
            </div>

            <div class="h5 text-left mt-3">Seller</div>
            <div class="d-flex flex-column">
              <label for="3000">
                <input
                  type="checkbox"
                  name="Seller"
                  value="3000"
                  id="3000"
                  class=""
                />
                Amazon
              </label>
              <label for="1000">
                <input
                  type="checkbox"
                  name="Seller"
                  id="1000"
                  value="1000"
                  class=""
                />
                Forsan
              </label>
              <label for="4000">
                <input type="checkbox" name="Seller" id="4000" value="4000" />
                Noon
              </label>
              <label for="5000">
                <input type="checkbox" name="Seller" id="5000" value="5000" />
                Carrefour
              </label>
              <label for="6000">
                <input type="checkbox" name="Seller" id="6000" value="6000" />
                Souq
              </label>
              <label for="2000">
                <input type="checkbox" name="Seller" id="2000" value="2000" />
                Sigma
              </label>
            </div>

            <div class="h5 text-left mt-3">Price</div>
            <div class="d-flex flex-column price">
              <label for="p4">
                <input type="radio" name="Range" id="p4" value="4" class="p-3" />
                All
              </label>
              <label for="p1">
                <input type="radio" name="Range" id="p1" value="1" class="p-3" />
                5000 - 10000
              </label>
              <label for="p2">
                <input type="radio" name="Range" id="p2" value="2" class="p-3" />
                10000 - 20000
              </label>
              <label for="p3">
                <input type="radio" name="Range" id="p3" value="3" class="p-3" />
                20000 - 70000
              </label>
            </div>

            <div class="mt-3">
              <span>
                <input
                  type="submit"
                  value="Apply"
                  class="form-control"
                  placeholder="Search"
                />
              </span>
              <span> </span>
            </div>
          </div>
        </form>
      </div>
      <div class="col-lg-10 d-flex flex-column p-4">
        <div class="input-group">
          <div class="input-group-prepend">
            <div class="input-group-text search">
              <i class="fa-solid fa-magnifying-glass"></i>
            </div>
          </div>
          <input
            type="text"
            class="form-control search-val"
            placeholder="Search"
            id="search"
          />
        </div>

        <div class="h4">
          Showing
          <span class="text-secondary pr-2"
            >(<span id="count"></span>) products</span
          >
        </div>
        <div
          class="d-flex flex-row flex-wrap"
          id="data-container"
          style="overflow-y: scroll"
        ></div>
      </div>
    </div>
    <script>
      let RangeObj = {
        1: [5000, 10000],
        2: [10000, 20000],
        3: [20000, 70000],
        4: [0, 700000],
      };
      let data = JSON.parse(localStorage.getItem("data"));
      let pramas = new URLSearchParams(window.location.search);
      let sellers = pramas.getAll("Seller");
      let category = pramas.getAll("category");
      let range =  pramas.get("Range") == null ? 4 : pramas.get("Range");
      sellers.forEach((item) => {
        document.getElementById(item).checked = true;
      });
      category.forEach((item) => {
        document.getElementById(item).checked = true;
      });
      document.getElementById('p'+range).checked = true;
      // following the hierarcy we dont have to search the entire dataset  === improved performance
      function filter(ObjectOfProducts, sellers, category, range) {
        category =
          category.length === 0 ? ["laptops", "watches", "screens"] : category;
        sellers =
          sellers.length === 0
            ? ["3000", "1000", "4000", "5000", "6000", "2000"]
            : sellers;
        let filteredProducts = [];
        for (const key in ObjectOfProducts) {
          if (category.indexOf(key) != -1) {
            for (const item in ObjectOfProducts[key]) {
              if (
                sellers.indexOf(ObjectOfProducts[key][item]["sellerId"]) != -1
              ) {
                if (
                  parseInt(ObjectOfProducts[key][item]["price"]) >=
                    RangeObj[range][0] &&
                  parseInt(ObjectOfProducts[key][item]["price"]) <=
                    RangeObj[range][1]
                ) {
                  filteredProducts.push({
                    id: item,
                    category: key,
                    ...ObjectOfProducts[key][item],
                  });
                }
              }
            }
          }
        }
        return filteredProducts;
      }
      /*
        function RenderTable(ArrayOfProducts) {
          for (const key in ArrayOfProducts) {
            for (const item in ArrayOfProducts[key]) {
              if (ArrayOfProducts[key][item]["title"].length > 30) {
                ArrayOfProducts[key][item]["title"] =
                  ArrayOfProducts[key][item]["title"].slice(0, 20) + "...";
              }

              $("#data-container").append(
                `<a
            href=${"/product.html?category=" + key + "&id=" + item}
            class="text-decoration-none col-lg-3 col-md-4 col-sm-6 col-12"
          >
            <div class="p-2 shadow rounded">
              <img src="${
                ArrayOfProducts[key][item]["pic"]
              }" alt="" class="col-12 item-img" />
              <div class="px-3">
                <div class="h7 item-title">${
                  ArrayOfProducts[key][item]["title"]
                }</div>
                <div class="d-flex mt-1 rating text-info align-items-center">
                  <i class="fa-solid fa-star" style="color: yellow"></i>
                  <i class="fa-solid fa-star" style="color: yellow"></i>
                  <i class="fa-solid fa-star" style="color: yellow"></i>
                  <i class="fa-solid fa-star" style="color: yellow"></i>
                  <i class="fa-solid fa-star"></i>
                  <span class="pl-2 text-secondary">(120)</span>
                </div>
                <div>
                  <span class="text-danger h5 item-price">${
                    ArrayOfProducts[key][item]["price"]
                  } EGP</span>
                </div>
              </div>
              <div class="btn btn-outline-primary form-control mt-3">
                Add To Cart
              </div>
            </div>
          </a>
         `
              );
            }
          }
        }
 */
      const RenderProducts = function (ArrayOfProducts) {
        $("#data-container").get(0).innerHTML = "";
        for (let i = 0; i < ArrayOfProducts.length; i++) {
          if (ArrayOfProducts[i].title.length > 30) {
            ArrayOfProducts[i].title =
              ArrayOfProducts[i].title.slice(0, 20) + "...";
          }
          $("#data-container").append(
            `<a
        href="product.html?category=${ArrayOfProducts[i].category}&id=${ArrayOfProducts[i].id}"
        class="text-decoration-none col-lg-3 col-md-4 col-sm-6 col-12"
      >
        <div class="p-2 shadow rounded">
          <img src="${ArrayOfProducts[i].pic}" alt="" class="col-12 item-img" />
          <div class="px-3">
            <div class="h7 item-title">${ArrayOfProducts[i].title}</div>
            <div class="d-flex mt-1 rating text-info align-items-center">
              <i class="fa-solid fa-star" style="color: yellow"></i>
              <i class="fa-solid fa-star" style="color: yellow"></i>
              <i class="fa-solid fa-star" style="color: yellow"></i>
              <i class="fa-solid fa-star" style="color: yellow"></i>
              <i class="fa-solid fa-star"></i>
              <span class="pl-2 text-secondary">(120)</span>
            </div>
            <div>
              <span class="text-danger h5 item-price">${ArrayOfProducts[i].price} EGP</span>
            </div>
          </div>
          <div class="btn btn-outline-primary form-control mt-3">
            Add To Cart
          </div>
        </div>
      </a>
     `
          );
        }
      };
      let filteredProducts = filter(data, sellers, category, range);
      $("#count").text(filteredProducts.length);
      RenderProducts(filteredProducts);
      $(".search").on("click", function () {
        let val = $("#search").val();
        f = filteredProducts.filter(
          (item) =>
            item.title.toLowerCase().includes(val.toLowerCase()) ||
            item.sellerId.toLowerCase().includes(val.toLowerCase())
        );
        $("#count").text(f.length);
        RenderProducts(f);
      });
    </script>
  </body>
</html>
