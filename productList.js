let data ={
  "watchs": {
    "143": {
      "title": "Samsung Galaxy Watch5 Pro BT Smart Watch, 45mm - Black Titanium",
      "price": "16000",
      "pic": "/smartwatchs/watch_img7.jpg",
      "sellerId": "1000",
      "specs": {
        "brand": "Samsung",
        "display": "45mm",
        "color": "Black Titanium",
        "features": ["Bluetooth", "Smartwatch"]
      }
    },
    "1416": {
      "title": "Huawei Watch GT 4 , Smart Watch, Silver Case- Black Strap",
      "price": "11,200",
      "pic": "/smartwatchs/watch_img8.jpg",
      "sellerId": "1000",
      "specs": {
        "brand": "Huawei",
        "display": "Not specified",
        "color": "Silver Case-Black Strap",
        "features": ["Smartwatch"]
      }
    },
    "4042": {
      "title": "Oraimo Smart Watch, Black - OSW-16",
      "price": "15000",
      "pic": "/smartwatchs/watch_img14.jpg",
      "sellerId": "1000",
      "specs": {
        "brand": "Oraimo",
        "display": "Not specified",
        "color": "Black",
        "features": ["Smartwatch"]
      }
    },
    "5423": {
      "title": "Z91 Ultra Smart Watch, Silver Case and Grey Strap",
      "price": "12500",
      "pic": "/smartwatchs/watch_img1.jpg",
      "sellerId": "2000",
      "specs": {
        "brand": "Z91",
        "display": "Not specified",
        "color": "Silver Case and Grey Strap",
        "features": ["Ultra Smartwatch"]
      }
    },
    "5457": {
      "title": "Wiwu SW02 Smart Watch- Silver",
      "price": "1990",
      "pic": "/smartwatchs/watch_img9.jpg",
      "sellerId": "2000",
      "specs": {
        "brand": "Wiwu",
        "display": "Not specified",
        "color": "Silver",
        "features": ["Smartwatch"]
      }
    },
    "5487": {
      "title": "Wiwu SW01 Ultra Smart Watch, 1.9 Inch - Gold",
      "price": "17000",
      "pic": "/smartwatchs/watch_img2.jpg",
      "sellerId": "2000",
      "specs": {
        "brand": "Wiwu",
        "display": "1.9 Inch",
        "color": "Gold",
        "features": ["Ultra Smartwatch"]
      }
    }
  },
  "laptops": {
    "30": {
      "title": "Lenovo IdeaPad Gaming 3 15IAH7 Laptop",
      "price": " 53100",
      "pic": "/laptops/lap_img25.jpg",
      "sellerId": "1000",
      "specs": {
        "cpu": " Intel Core i7-12650H",
        "ssd": " 15.6 Inch",
        "ram": " 512GB SSD",
        "screen": " 16GB RAM",
        "GPU": " NVIDIA GeForce RTX 3050 Ti 4GB GDDR6 Graphics"
      },
    },
    "201": {
      "title": "HP Chromebook 11A G8 Education Laptop",
      "price": "18000",
      "pic": "/laptops/lap_img16.jpg",
      "sellerId": "1000",
      "specs": {
        "cpu": " AMD A4-9120C",
        "ssd": " 11.6 Inch",
        "ram": " 32GB SSD",
        "screen": " 4GB RAM",
        "GPU": " AMD Radeon R4 Graphics"
      },
    },
    "508": {
      "title": "HP Pavilion 15s-eq1001ne Laptop",
      "price": " 17499",
      "pic": "/laptops/lap_img24.jpg",
      "sellerId": "1000",
      "specs": {
        "cpu": " AMD Ryzen 3-3250U",
        "ssd": " 15.6Inch FHD",
        "ram": " 256GB SSD",
        "screen": " 4GB RAM",
        "GPU": " AMD Radeon Integrated Graphics"
      },
    },
    "536": {
      "title": "Lenovo IdeaPad 3 Laptop",
      "price": " 18199",
      "pic": "/laptops/lap_img5.jpg",
      "sellerId": "1000",
      "specs": {
        "cpu": " Intel Core i3-1115G4",
        "ssd": " 15.6 Inch UHD",
        "ram": " 256 GB SSD",
        "screen": " 4GB RAM",
        "GPU": " Integrated Intel UHD Graphics"
      },
    },
    "747": {
      "title": "Lenovo IdeaPad 5 15ITL05 Laptop",
      "price": " 40449",
      "pic": "/laptops/lap_img6.jpg",
      "sellerId": "2000",
      "specs": {
        "cpu": " 15.6 Inch",
        "ssd": " Intel Core i7-1165G7",
        "ram": " 512GB SSD",
        "screen": " 8GB RAM",
        "GPU": " Nvidia GeForce MX450 2GB"
      },
    }
  },
  "screens": {
    "128": {
      "title": "LG 50 Inch 4K UHD Smart LED TV with Built in Receiver",
      "price": "18499",
      "pic": "/smartscreens/screen_img11.jpg",
      "sellerId": "5000",
      "specs": {
        "screen_size": "50 inches",
        "resolution": "4K UHD",
        "smart_feature": true,
        "built_in_receiver": true
      },
    },
    "354": {
      "title": "LG OLED 55 Inch Smart TV with Magic Remote",
      "price": "53999",
      "pic": "/smartscreens/screen_img8.jpg",
      "sellerId": "5000",
      "specs": {
        "screen_size": "55 inches",
        "resolution": "OLED",
        "smart_feature": true,
        "built_in_receiver": false
      },
    },
    "1967": {
      "title": "LG 32 Inch FHD Smart LED TV",
      "price": "8499",
      "pic": "/smartscreens/screen_img3.jpg",
      "sellerId": "5000",
      "specs": {
        "screen_size": "32 inches",
        "resolution": "FHD",
        "smart_feature": true,
        "built_in_receiver": false
      },
    },
    "3395": {
      "title": "LG UQ7500 Series, 55 Inch 4K UHD Smart LED TV With Built in Receiver",
      "price": "21499",
      "pic": "/smartscreens/screen_img4.jpg",
      "sellerId": "5000",
      "specs": {
        "screen_size": "55 inches",
        "resolution": "4K UHD",
        "smart_feature": true,
        "built_in_receiver": true
      },
    },
    "3569": {
      "title": "LG 55 Inch 4K UHD Smart LED TV with Built",
      "price": "21499",
      "pic": "/smartscreens/screen_img2.jpg",
      "sellerId": "5000",
      "specs": {
        "screen_size": "55 inches",
        "resolution": "4K UHD",
        "smart_feature": true,
        "built_in_receiver": true
      },
    }
  }}
function transformDataToArray(data) {
    let result = [];

    $.each(data, function (category, items) {
        $.each(items, function (id, item) {
            let product = {
                id: id,
                category: category,
                title: item.title,
                price: item.price,
                pic: item.pic,
                sellerId: item.sellerId,
                specs: item.specs,
            };
            result.push(product);
        });
    });

    return result;
}


let Products = transformDataToArray(data);
localStorage.setItem("Products", JSON.stringify(data));
$(document).ready(function () {
    drawTable(Products);
    initializeDataTable();

    $("#filter_search").click(function () {
        $(".filter-search").toggleClass("active");
});

function drawTable(data) {
    let targetContainer = $("#dynamic-table-container");
     targetContainer.innerHTML = "";
    let table = $("<table>").addClass("table datanew");
    drawHeader(table, data);
    drawBody(table, data);
    targetContainer.append(table);
}

function drawHeader(target, test) {
    let tableHeader = $("<thead>");
    let tableHeaderRow = $("<tr>");
    let headers = Object.keys(test[0]);

    // Add select all checkbox
    let thCheckbox = $("<th>").append(
        $("<label>").addClass("checkboxs").append(
            $("<input>").attr({ type: "checkbox", id: "select-all" }),
            $("<span>").addClass("checkmarks")
        )
    );
    tableHeaderRow.append(thCheckbox);
    // handle sepcs object
    for (let header of headers) {
        if (header == "specs") {
            // let heads = Object.keys(test[0][header]);
            // for (let head of heads) {
            //     let th = $("<th>").text(head);
            //     tableHeaderRow.append(th);
            // }
        } else {
            let th = $("<th>").text(header);
            tableHeaderRow.append(th);
        }
    }
    // add actions to the end of row
    let actions = $("<th>").text("actions");
    tableHeaderRow.append(actions);

    tableHeader.append(tableHeaderRow);
    target.append(tableHeader);
}

function drawBody(target,test) {
    let tableBody = $("<tbody>");
    let actionButtons = ["eye", "edit", "delete"];
    const currentRow = $(this).closest("tr");
    const productId = currentRow.find("td:eq(1)").text();
   


  for(let j = 0; j < Products.length; j++){    
    let rowData = Object.values(test[j]);

    let row = $("<tr>");

    // Create checkbox cell
    let checkboxCell = $("<td>").append(
        $("<label>").addClass("checkboxs").append(
            $("<input>").attr("type", "checkbox"),
            $("<span>").addClass("checkmarks")
        )
    );
    row.append(checkboxCell);

    // Loop through rowData and create cells
    for (let i = 0; i < rowData.length; i++) {

        // If the value is an object, handle it differently
        if (typeof rowData[i] === "object") {
            // let specs = Object.values(rowData[i]);
            // for (let spec of specs) {
            //     if (spec.length > 20) {
            //         spec = spec.slice(0, 20);
            //     }
            //     else if(typeof(spec)=="boolean"){
            //       spec = "not specified";
            //     }
            //     let cell1 = $("<td>").text(spec);
            //     row.append(cell1);
            // }
        } 
        
        //if the value is src of image
        else if (rowData[i].includes("img")) {
          let cell = $("<td>");
            let cell1 = $("<td>").append(
              //rowData[i] insetead link of image
                $("<img>").attr("src",'/assets/img/product/product1.jpg' ).attr("alt", "img")
            );
            row.append(cell1);
        }
        else {
          let cell = $("<td>");
            if (rowData[i].length > 20) {
              rowData[i] = rowData[i].slice(0, 20);
                }
            cell.text(rowData[i]);
            row.append(cell);
        }
    }

    // Create action buttons cell
    let actionCell = $("<td>");
    for (let buttonType of actionButtons) {
    
        let button = $("<a>").addClass("me-3").append(
            $("<img>").attr("src", `assets/img/icons/${buttonType}.svg`).attr("alt", "img")
        );
        const productId = row.find("td:eq(1)").text();
        
        switch (buttonType) {
          
            case 'delete':
                button.on("click",()=>{
                  deleteAction(productId, row);
                });
                break;
            case 'edit':
                button.on("click",() => {
                  window.location.href = `editProduct.html?id=${productId}`; // Include product ID in the URL
                });
                break;
            case 'eye':
                button.on("click",() => {
                  window.location.href = `productDetails.html?id=${productId}`; // Include product ID in the URL
                });
                break;
        }

        actionCell.append(button);
    }
    row.append(actionCell);

    // Append the row to the table body
    tableBody.append(row);

  }
    target.append(tableBody);
}
function initializeDataTable() {
  if ($(".datanew").length > 0) {
      // Destroy existing DataTables
      $(".datanew").DataTable().destroy();

      $(".datanew").DataTable({
          bFilter: true,
          sDom: "fBtlpi",
          pagingType: "numbers",
          ordering: true,
          language: {
              search: " ",
              sLengthMenu: "_MENU_",
              searchPlaceholder: "Search...",
              info: "_START_ - _END_ of _TOTAL_ items",
          },
          initComplete: (settings, json) => {
              $(".dataTables_filter").appendTo("#tableSearch");
              $(".dataTables_filter").appendTo(".search-input");
          },
      });
  }

  var selectAllItems = "#select-all";
  var checkboxItem = ":checkbox";
  $(selectAllItems).click(function () {
      if (this.checked) {
          $(checkboxItem).each(function () {
              this.checked = true;
          });
      } else {
          $(checkboxItem).each(function () {
              this.checked = false;
          });
      }
  });
}
function deleteAction (id, row) {
  // Show SweetAlert confirmation
  Swal.fire({
      title: 'Are you sure?',
      text: 'You won\'t be able to revert this!',
      icon: 'warning',
      showCancelButton: true,
      confirmButtonColor: '#3085d6',
      cancelButtonColor: '#d33',
      confirmButtonText: 'Yes, delete it!'
  }).then((result) => {
      if (result.isConfirmed) {
        Products = Products.filter(product => product.id !== id);
        console.log(Products);
        drawTable(Products); // Redraw the table
        initializeDataTable(); // Reinitialize the datatable        

          Swal.fire(
              'Deleted!',
              'Your file has been deleted.',
              'success'
          );
      }
  });
}

});
